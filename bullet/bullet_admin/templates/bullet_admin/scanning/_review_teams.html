{% load access utils %}
{% if not venue.is_reviewed and not venue.has_unreviewed_teams %}
    {% is_admin_in venue as can_finish %}
    {% aalert color="orange" class="mb-4" %}
        {% if can_finish %}
            {% url "badmin:scanning_review" as back_url %}
            {% add_query back_url venue=venue.id as back_url %}
            <p>
                All teams in this venue are reviewed. Please, <a class="link"
    href="{% url "badmin:venue_finish_review" venue.id %}?next={{ back_url|urlencode }}">finish the review</a> when ready.
            </p>
        {% else %}
            <p>
                All teams in this venue are reviewed. Please ask the venue administrator to finish review when ready.
            </p>
        {% endif %}
    {% endaalert %}
{% endif %}
{% if venue.is_reviewed %}
    {% aalert color="green" class="mb-4" %}
        <p>This venue was marked as reviewed.</p>
        {% is_country_admin_in venue as can_unreview %}
        {% if can_unreview and not venue.category.competition.results_public %}
            {% url "badmin:scanning_review" as back_url %}
            {% add_query back_url venue=venue.id as back_url %}
            <p>
                <a class="link" href="{% url "badmin:venue_unreview" venue.id %}?next={{ back_url|urlencode }}">Click here</a> to mark the venue as unreviewed if you want to make changes to teams or problems.
            </p>
        {% endif %}
    {% endaalert %}
{% endif %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2">
    {% for team in teams %}
        <div class="border {% if team.is_reviewed %} bg-green-100 border-green-700 {% else %} bg-red-100 border-red-700 {% endif %} py-2 px-3 rounded-md flex flex-col justify-between">
            <div class="flex flex-col">
            <div class="text-lg flex items-center gap-2">
                {% if team.is_reviewed %}
                    <b-icon icon="mdi:check-circle" class="size-6 text-green-600"></b-icon>
                {% else %}
                    <b-icon icon="mdi:cross-circle" class="size-6 text-red-600"></b-icon>
                {% endif %}
                <span class="font-mono">{{ team.code }}</span>
            </div>
            <div class="text-xs">{{ team.display_name }}</div>
        </div>
            {% if not venue.is_reviewed %}
                <div class="mt-1 flex flex-wrap gap-1">
                    {% if not team.is_reviewed %}
                        <a href="{% url "badmin:scanning_review_team" pk=team.id %}"
                           class="btn-admin-sm bg-blue-500 hover:bg-blue-600 flex items-center gap-2"><b-icon icon="mdi:edit" class="size-5"></b-icon> Edit problems</a>
                    {% endif %}
                    <button hx-post="{% url "badmin:scanning_review_toggle_team" pk=team.id %}"
                            class="btn-admin-sm {% if team.is_reviewed %} bg-red-500 hover:bg-red-600 {% else %} bg-green-500 hover:bg-green-600 {% endif %} flex items-center gap-2">
                        <b-icon icon="mdi:{% if team.is_reviewed %}close{% else %}check{% endif %}" class="size-5"></b-icon> Mark as
                        {% if team.is_reviewed %}un{% endif %}reviewed
                    </button>
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>
